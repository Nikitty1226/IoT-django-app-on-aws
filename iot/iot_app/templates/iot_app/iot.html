{% extends "iot_app/base.html" %}
{% block content %}

<div class="header">
    <h1>è¦‹å®ˆã‚Šãƒ‰ã‚¢ã‚»ãƒ³ã‚µãƒ¼</h1>
</div>

<div class="top">
    <div class="user">
        <p class="break-word">{{request.user}}ã§ãƒ­ã‚°ã‚¤ãƒ³ä¸­</p>
    </div>

    <div class="reload">
        <button onclick="location.reload()">æ›´æ–°</button>
    </div>
</div>

<div class="opendoortime">
   <div class="timeeditheader">
        <h3>æœ€æ–°ã®ãƒ‰ã‚¢é–‹é–‰æ™‚åˆ»</h3>
        {% if device %}
            <a href="{% url 'time-edit' %}" class="EditButton">&#x270f;</a>
        {% endif %}
    </div>

    {% if device %}
        {% if openclose_exist %}
            <h2>{{ latest_log.openclose_timestamp|date:"Y-m-d H:i:s" }} ãƒ¼ {{ latest_log.get_status_display }}</h2>
            {% if openclose_ok %}
                <p class="status normal">ğŸŸ¢ æ­£å¸¸</p>
            {% else %}
                <p class="status alert">â— ç•°å¸¸â€•{{ device.threshold_notopen_hours }}æ™‚é–“ä»¥ä¸Šé–‹ã„ã¦ã„ã¾ã›ã‚“</p>
            {% endif %}
        {% else %}
            <h3>ãƒ¼</h3>
            <p class="status alert">â— ç•°å¸¸â€•ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
        {% endif %}
    {% else %}
        <h3>ãƒ¼</h3>
        <p class="status alert">â— ç•°å¸¸â€•ãƒ‡ãƒã‚¤ã‚¹æœªç™»éŒ²ã§ã™</p>
    {% endif %}
</div>

<div class="sensorheader">
  <div class="sensordetail">
    <div class="sensordetailheader">
        <h3>ãƒ‡ãƒã‚¤ã‚¹è©³ç´°</h3>
        {% if device %}
            <div>
                <a href="{% url 'edit-iot' %}" class="EditButton">&#x270f;</a>
                <a href="{% url 'delete-iot' %}" class="DeleteButton">Ã—</a>
            </div>
        {% else %}
            <div>
                <a href="{% url 'create-iot' %}" class="AddButton">ï¼‹</a>
            </div>
        {% endif %}
    </div>   

    <div> 
        {% if device %}
            <div>
                <p class="break-word"> åç§°ï¼š{{ device.device_name }} </p>
                <p class="break-word"> IDï¼š{{ device.device_id }} </p>
                <p class="break-word"> è©³ç´°ï¼š{{ device.device_description }} </p>
            </div>
        {% else %}
            <div>
                <p> ãƒ‡ãƒã‚¤ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“ </p>
            </div>
        {% endif %}
    </div>
  </div>

  <div class="sensorping">
    <div class="timeeditheader">
        <h3>æœ€çµ‚æ›´æ–°æ™‚åˆ»</h3>
        {% if device %}
            <a href="{% url 'time-edit' %}" class="EditButton">&#x270f;</a>
        {% endif %}
    </div>

    {% if device %}
        {% if heartbeat_exist %}
            <h2>{{ device.heartbeat_timestamp|date:"Y-m-d H:i:s" }}</h2>
            {% if heartbeat_ok %}
                <p class="status normal">ğŸŸ¢ æ­£å¸¸</p>
            {% else %}
                <p class="status alert">â— ç•°å¸¸â€•{{ device.threshold_heartbeat_hours }}æ™‚é–“ä»¥ä¸Šãƒ‡ãƒ¼ã‚¿ãŒæ¥ã¦ã„ã¾ã›ã‚“</p>
            {% endif %}
        {% else %}
            <h3>ãƒ¼</h3>
            <p class="status alert">â— ç•°å¸¸â€•ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
        {% endif %}
    {% else %}
        <h3>ãƒ¼</h3>
        <p class="status alert">â— ç•°å¸¸â€•ãƒ‡ãƒã‚¤ã‚¹æœªç™»éŒ²ã§ã™</p>
    {% endif %}
  </div>
</div>

<div class="opencloselogs">
    <h3>ãƒ‰ã‚¢é–‹é–‰å±¥æ­´</h3>
    {% if openclose_logs %}
        {% for log in openclose_logs %}
            <p>{{ log.openclose_timestamp|date:"Y-m-d H:i:s" }} ãƒ¼ {{ log.get_status_display }}</p>
        {% endfor %}
    {% else %}
        <p>å±¥æ­´ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
    {% endif %}
</div>

<div class="LoginAndLogout">
    <form action="{% url 'logout' %}" method="POST">
        {% csrf_token %}
        <input type="submit" value="ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ">
    </form>
    <a href="{% url 'account-delete' %}" class="delete">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤</a>
</div>


{% endblock content %}
